# Created by: Julien Laffaye <kimelto@gmail.com>
# $FreeBSD$

PORTNAME=	soci
PORTVERSION=	3.2.2
PORTREVISION=	7
CATEGORIES=	databases
MASTER_SITES=	SF/${PORTNAME}/${PORTNAME}/${PORTNAME}-${PORTVERSION}

MAINTAINER=	jlaffaye@FreeBSD.org
COMMENT=	The C++ Database Access Library

LICENSE=	BSL
LICENSE_FILE=	${WRKSRC}/LICENSE_1_0.txt

BROKEN_armv6=		fails to compile: backends/mysql/session.cpp:202:22: error: ordered comparison between pointer and zero ('int *' and 'int')
BROKEN_armv7=		fails to compile: backends/mysql/session.cpp:202:22: error: ordered comparison between pointer and zero ('int *' and 'int')

USES=		cmake zip
CMAKE_ARGS+=	-DWITH_ORACLE:BOOL=OFF
USE_LDCONFIG=	yes

SUB_FILES=	pkg-message
PKGMESSAGE=	${WRKDIR}/pkg-message

OPTIONS_DEFINE=	MYSQL PGSQL SQLITE ODBC BOOST FIREBIRD
BOOST_DESC=	Enable support for additional types using Boost
OPTIONS_DEFAULT=MYSQL PGSQL SQLITE ODBC BOOST FIREBIRD
OPTIONS_SUB=	yes

# firebird is currently only available on x86.
OPTIONS_EXCLUDE_aarch64=	FIREBIRD
OPTIONS_EXCLUDE_armv6=		FIREBIRD
OPTIONS_EXCLUDE_armv7=		FIREBIRD
OPTIONS_EXCLUDE_mips=		FIREBIRD
OPTIONS_EXCLUDE_mips64=		FIREBIRD
OPTIONS_EXCLUDE_powerpc=	FIREBIRD
OPTIONS_EXCLUDE_powerpc64=	FIREBIRD
OPTIONS_EXCLUDE_sparc64=	FIREBIRD

MYSQL_USE=	MYSQL=yes
MYSQL_CMAKE_ON=	-DWITH_MYSQL:BOOL=ON
MYSQL_CMAKE_OFF=	-DWITH_MYSQL:BOOL=OFF

PGSQL_USES=	pgsql
PGSQL_CMAKE_ON=	-DWITH_POSTGRESQL:BOOL=ON
PGSQL_CMAKE_OFF=	-DWITH_POSTGRESQL:BOOL=OFF

SQLITE_USES=	sqlite
SQLITE_CMAKE_ON=	-DWITH_SQLITE3:BOOL=ON
SQLITE_CMAKE_OFF=	-DWITH_SQLITE3:BOOL=OFF

ODBC_LIB_DEPENDS=	libodbc.so:databases/unixODBC
ODBC_CMAKE_ON=	-DODBC_LIBRARY:FILE_PATH=${LOCALBASE}/lib/libodbc.so \
		-DWITH_ODBC:BOOL=ON
ODBC_CMAKE_OFF=	-DWITH_ODBC:BOOL=OFF

BOOST_LIB_DEPENDS=	libboost_date_time.so:devel/boost-libs
BOOST_CMAKE_ON=	-DWITH_BOOST:BOOL=ON
BOOST_CMAKE_OFF=	-DWITH_BOOST:BOOL=OFF

FIREBIRD_USES=	firebird
FIREBIRD_CMAKE_ON=	-DWITH_FIREBIRD:BOOL=ON
FIREBIRD_CMAKE_OFF=	-DWITH_FIREBIRD:BOOL=OFF

.include <bsd.port.mk>
